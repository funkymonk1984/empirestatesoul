var tagBox,array_unique_noempty;!function($){array_unique_noempty=function(t){var i=[];return $.each(t,function(t,a){a=$.trim(a),a&&-1===$.inArray(a,i)&&i.push(a)}),i},tagBox={clean:function(t){var i=window.tagsBoxL10n.tagDelimiter;return","!==i&&(t=t.replace(new RegExp(i,"g"),",")),t=t.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,""),","!==i&&(t=t.replace(/,/g,i)),t},parseTags:function(t){var i=t.id,a=i.split("-check-num-")[1],e=$(t).closest(".tagsdiv"),n=e.find(".the-tags"),s=window.tagsBoxL10n.tagDelimiter,c=n.val().split(s),u=[];return delete c[a],$.each(c,function(t,i){i=$.trim(i),i&&u.push(i)}),n.val(this.clean(u.join(s))),this.quickClicks(e),!1},quickClicks:function(t){var i=$(".the-tags",t),a=$(".tagchecklist",t),e=$(t).attr("id"),n,s;i.length&&(s=i.prop("disabled"),n=i.val().split(window.tagsBoxL10n.tagDelimiter),a.empty(),$.each(n,function(t,i){var n,c;i=$.trim(i),i&&(n=$("<span />").text(i),s||(c=$('<a id="'+e+"-check-num-"+t+'" class="ntdelbutton" tabindex="0">X</a>'),c.on("click keypress",function(t){("click"===t.type||13===t.keyCode)&&(13===t.keyCode&&$(this).closest(".tagsdiv").find("input.newtag").focus(),tagBox.parseTags(this))}),n.prepend("&nbsp;").prepend(c)),a.append(n))}))},flushTags:function(t,i,a){var e,n,s,c=$(".the-tags",t),u=$("input.newtag",t),o=window.tagsBoxL10n.tagDelimiter;return i=i||!1,s=i?$(i).text():u.val(),"undefined"==typeof s?!1:(e=c.val(),n=e?e+o+s:s,n=this.clean(n),n=array_unique_noempty(n.split(o)).join(o),c.val(n),this.quickClicks(t),i||u.val(""),"undefined"==typeof a&&u.focus(),!1)},get:function(t){var i=t.substr(t.indexOf("-")+1);$.post(ajaxurl,{action:"get-tagcloud",tax:i},function(a,e){0!==a&&"success"==e&&(a=$('<p id="tagcloud-'+i+'" class="the-tagcloud">'+a+"</p>"),$("a",a).click(function(){return tagBox.flushTags($("#"+i),this),!1}),$("#"+t).after(a))})},init:function(){var t=this,i=$("div.ajaxtag");$(".tagsdiv").each(function(){tagBox.quickClicks(this)}),$(".tagadd",i).click(function(){t.flushTags($(this).closest(".tagsdiv"))}),$("input.newtag",i).keyup(function(t){return 13==t.which?(tagBox.flushTags($(this).closest(".tagsdiv")),!1):void 0}).keypress(function(t){return 13==t.which?(t.preventDefault(),!1):void 0}).each(function(){var t=$(this).closest("div.tagsdiv").attr("id");$(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+t,{delay:500,minchars:2,multiple:!0,multipleSep:window.tagsBoxL10n.tagDelimiter})}),$("#post").submit(function(){$("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})}),$(".tagcloud-link").click(function(){return tagBox.get($(this).attr("id")),$(this).unbind().click(function(){return $(this).siblings(".the-tagcloud").toggle(),!1}),!1})}}}(jQuery);