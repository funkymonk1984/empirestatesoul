window.wp=window.wp||{},function($,e,t){e.updates={},e.updates.ajaxNonce=window._wpUpdatesSettings.ajax_nonce,e.updates.l10n=window._wpUpdatesSettings.l10n,e.updates.shouldRequestFilesystemCredentials=null,e.updates.filesystemCredentials={ftp:{host:null,username:null,password:null,connectionType:null},ssh:{publicKey:null,privateKey:null}},e.updates.updateLock=!1,e.updates.updateDoneSuccessfully=!1,e.updates.updateQueue=[],e.updates.$elToReturnFocusToFromCredentialsModal=null,e.updates.decrementCount=function(e){var t,a,s=$("#wp-admin-bar-updates .ab-label"),u=$('a[href="update-core.php"] .update-plugins'),n=$("#menu-plugins");if(t=s.text(),t=parseInt(t,10)-1,!(0>t||isNaN(t))&&($("#wp-admin-bar-updates .ab-item").removeAttr("title"),s.text(t),u.each(function(e,a){a.className=a.className.replace(/count-\d+/,"count-"+t)}),u.removeAttr("title"),u.find(".update-count").text(t),"plugin"===e)){if(a=n.find(".plugin-count").eq(0).text(),a=parseInt(a,10)-1,0>a||isNaN(a))return;n.find(".plugin-count").text(a),n.find(".update-plugins").each(function(e,t){t.className=t.className.replace(/count-\d+/,"count-"+a)}),a>0?$(".subsubsub .upgrade .count").text("("+a+")"):$(".subsubsub .upgrade").remove()}},e.updates.updatePlugin=function(a,s){var u,n,d=$(".plugin-card-"+s);if("plugins"===t||"plugins-network"===t?u=$('[data-slug="'+s+'"]').next().find(".update-message"):"plugin-install"===t&&(u=d.find(".update-now"),n=u.data("name"),u.attr("aria-label",e.updates.l10n.updatingLabel.replace("%s",n)),d.removeClass("plugin-card-update-failed").find(".notice.notice-error").remove()),u.addClass("updating-message"),u.html()!==e.updates.l10n.updating&&u.data("originaltext",u.html()),u.text(e.updates.l10n.updating),e.a11y.speak(e.updates.l10n.updatingMsg),e.updates.updateLock)return void e.updates.updateQueue.push({type:"update-plugin",data:{plugin:a,slug:s}});e.updates.updateLock=!0;var l={_ajax_nonce:e.updates.ajaxNonce,plugin:a,slug:s,username:e.updates.filesystemCredentials.ftp.username,password:e.updates.filesystemCredentials.ftp.password,hostname:e.updates.filesystemCredentials.ftp.hostname,connection_type:e.updates.filesystemCredentials.ftp.connectionType,public_key:e.updates.filesystemCredentials.ssh.publicKey,private_key:e.updates.filesystemCredentials.ssh.privateKey};e.ajax.post("update-plugin",l).done(e.updates.updateSuccess).fail(e.updates.updateError)},e.updates.updateSuccess=function(a){var s,u,n,d;"plugins"===t||"plugins-network"===t?(n=$('[data-slug="'+a.slug+'"]').first(),s=n.next().find(".update-message"),n.addClass("updated").removeClass("update"),d=n.find(".plugin-version-author-uri").html().replace(a.oldVersion,a.newVersion),n.find(".plugin-version-author-uri").html(d),n.next().addClass("updated")):"plugin-install"===t&&(s=$(".plugin-card-"+a.slug).find(".update-now"),s.addClass("button-disabled"),u=s.data("name"),s.attr("aria-label",e.updates.l10n.updatedLabel.replace("%s",u))),s.removeClass("updating-message").addClass("updated-message"),s.text(e.updates.l10n.updated),e.a11y.speak(e.updates.l10n.updatedMsg),e.updates.decrementCount("plugin"),e.updates.updateDoneSuccessfully=!0,e.updates.updateLock=!1,$(document).trigger("wp-plugin-update-success",a),e.updates.queueChecker()},e.updates.updateError=function(a){var s=$(".plugin-card-"+a.slug),u,n,d,l;return e.updates.updateDoneSuccessfully=!1,a.errorCode&&"unable_to_connect_to_filesystem"==a.errorCode&&e.updates.shouldRequestFilesystemCredentials?void e.updates.credentialError(a,"update-plugin"):(l=e.updates.l10n.updateFailed.replace("%s",a.error),"plugins"===t||"plugins-network"===t?(u=$('[data-slug="'+a.slug+'"]').next().find(".update-message"),u.html(l).removeClass("updating-message")):"plugin-install"===t&&(n=s.find(".update-now"),d=n.data("name"),s.addClass("plugin-card-update-failed").append('<div class="notice notice-error is-dismissible"><p>'+l+"</p></div>"),n.attr("aria-label",e.updates.l10n.updateFailedLabel.replace("%s",d)).html(e.updates.l10n.updateFailedShort).removeClass("updating-message"),s.on("click",".notice.is-dismissible .notice-dismiss",function(){setTimeout(function(){s.removeClass("plugin-card-update-failed").find(".column-name a").focus()},200)})),e.a11y.speak(l,"assertive"),e.updates.updateLock=!1,$(document).trigger("wp-plugin-update-error",a),void e.updates.queueChecker())},e.updates.showErrorInCredentialsForm=function(e){var t=$(".notification-dialog");t.find(".error").remove(),t.find("h3").after('<div class="error">'+e+"</div>")},e.updates.credentialError=function(t,a){e.updates.updateQueue.push({type:a,data:{plugin:t.plugin,slug:t.slug}}),e.updates.showErrorInCredentialsForm(t.error),e.updates.requestFilesystemCredentials()},e.updates.queueChecker=function(){if(!(e.updates.updateLock||e.updates.updateQueue.length<=0)){var t=e.updates.updateQueue.shift();e.updates.updatePlugin(t.data.plugin,t.data.slug)}},e.updates.requestFilesystemCredentials=function(a){e.updates.updateDoneSuccessfully===!1&&("plugin-install"===t&&a&&(e.updates.$elToReturnFocusToFromCredentialsModal=$(a.target)),e.updates.updateLock=!0,e.updates.requestForCredentialsModalOpen())},e.updates.keydown=function(t){27===t.keyCode?e.updates.requestForCredentialsModalCancel():9===t.keyCode&&("upgrade"!==t.target.id||t.shiftKey?"hostname"===t.target.id&&t.shiftKey&&($("#upgrade").focus(),t.preventDefault()):($("#hostname").focus(),t.preventDefault()))},e.updates.requestForCredentialsModalOpen=function(){var t=$("#request-filesystem-credentials-dialog");$("body").addClass("modal-open"),t.show(),t.find("input:enabled:first").focus(),t.keydown(e.updates.keydown)},e.updates.requestForCredentialsModalClose=function(){$("#request-filesystem-credentials-dialog").hide(),$("body").removeClass("modal-open"),e.updates.$elToReturnFocusToFromCredentialsModal.focus()},e.updates.requestForCredentialsModalCancel=function(){var a,s;(e.updates.updateLock!==!1||0!==e.updates.updateQueue.length)&&(a=e.updates.updateQueue[0].data.slug,e.updates.updateLock=!1,e.updates.updateQueue=[],e.updates.requestForCredentialsModalClose(),"plugins"===t||"plugins-network"===t?s=$('[data-slug="'+a+'"]').next().find(".update-message"):"plugin-install"===t&&(s=$(".plugin-card-"+a).find(".update-now")),s.removeClass("updating-message"),s.html(s.data("originaltext")),e.a11y.speak(e.updates.l10n.updateCancel))},e.updates.beforeunload=function(){return e.updates.updateLock?e.updates.l10n.beforeunload:void 0},$(document).ready(function(){e.updates.shouldRequestFilesystemCredentials=$("#request-filesystem-credentials-dialog").length<=0?!1:!0,$("#request-filesystem-credentials-dialog form").on("submit",function(){return e.updates.filesystemCredentials.ftp.hostname=$("#hostname").val(),e.updates.filesystemCredentials.ftp.username=$("#username").val(),e.updates.filesystemCredentials.ftp.password=$("#password").val(),e.updates.filesystemCredentials.ftp.connectionType=$('input[name="connection_type"]:checked').val(),e.updates.filesystemCredentials.ssh.publicKey=$("#public_key").val(),e.updates.filesystemCredentials.ssh.privateKey=$("#private_key").val(),e.updates.requestForCredentialsModalClose(),e.updates.updateLock=!1,e.updates.queueChecker(),!1}),$('#request-filesystem-credentials-dialog [data-js-action="close"], .notification-dialog-background').on("click",function(){e.updates.requestForCredentialsModalCancel()}),$('#request-filesystem-credentials-dialog input[name="connection_type"]').on("change",function(){$(this).parents("form").find("#private_key, #public_key").parents("label").toggle("ssh"==$(this).val())}).change(),$(".plugin-update-tr").on("click",".update-link",function(t){t.preventDefault(),e.updates.shouldRequestFilesystemCredentials&&!e.updates.updateLock&&e.updates.requestFilesystemCredentials(t);var a=$(t.target).parents(".plugin-update-tr");e.updates.$elToReturnFocusToFromCredentialsModal=$("#"+a.data("slug")).find(".check-column input"),e.updates.updatePlugin(a.data("plugin"),a.data("slug"))}),$(".plugin-card").on("click",".update-now",function(t){t.preventDefault();var a=$(t.target);e.updates.shouldRequestFilesystemCredentials&&!e.updates.updateLock&&e.updates.requestFilesystemCredentials(t),e.updates.updatePlugin(a.data("plugin"),a.data("slug"))}),$("#plugin_update_from_iframe").on("click",function(e){var t,a;t=window.parent==window?null:window.parent,$.support.postMessage=!!window.postMessage,$.support.postMessage!==!1&&null!==t&&-1===window.parent.location.pathname.indexOf("update-core.php")&&(e.preventDefault(),a={action:"updatePlugin",slug:$(this).data("slug")},t.postMessage(JSON.stringify(a),window.location.origin))})}),$(window).on("message",function(a){var s=a.originalEvent,u,n=document.location,d=n.protocol+"//"+n.hostname;if(s.origin===d&&(u=$.parseJSON(s.data),"undefined"!=typeof u.action))switch(u.action){case"decrementUpdateCount":e.updates.decrementCount(u.upgradeType);break;case"updatePlugin":tb_remove(),"plugins"===t||"plugins-network"===t?($("#"+u.slug).find(".check-column input").focus(),$('.plugin-update-tr[data-slug="'+u.slug+'"]').find(".update-link").trigger("click")):"plugin-install"===t&&($(".plugin-card-"+u.slug).find(".column-name a").focus(),$(".plugin-card-"+u.slug).find('[data-slug="'+u.slug+'"]').trigger("click"))}}),$(window).on("beforeunload",e.updates.beforeunload)}(jQuery,window.wp,window.pagenow,window.ajaxurl);