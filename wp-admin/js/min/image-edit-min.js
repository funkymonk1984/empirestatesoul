!function($){var i=window.imageEdit={iasapi:{},hold:{},postid:"",_view:!1,intval:function(i){return 0|i},setDisabled:function(i,t){t?i.removeClass("disabled").prop("disabled",!1):i.addClass("disabled").prop("disabled",!0)},init:function(i){var t=this,e=$("#image-editor-"+t.postid),a=t.intval($("#imgedit-x-"+i).val()),o=t.intval($("#imgedit-y-"+i).val());t.postid!==i&&e.length&&t.close(t.postid),t.hold.w=t.hold.ow=a,t.hold.h=t.hold.oh=o,t.hold.xy_ratio=a/o,t.hold.sizer=parseFloat($("#imgedit-sizer-"+i).val()),t.postid=i,$("#imgedit-response-"+i).empty(),$('input[type="text"]',"#imgedit-panel-"+i).keypress(function(i){var t=i.keyCode;if(36<t&&t<41&&$(this).blur(),13===t)return i.preventDefault(),i.stopPropagation(),!1})},toggleEditor:function(i,t){var e=$("#imgedit-wait-"+i);t?e.fadeIn("fast"):e.fadeOut("fast")},toggleHelp:function(i){var t=$(i);return t.attr("aria-expanded","false"===t.attr("aria-expanded")?"true":"false").parents(".imgedit-group-top").toggleClass("imgedit-help-toggled").find(".imgedit-help").slideToggle("fast"),!1},getTarget:function(i){return $('input[name="imgedit-target-'+i+'"]:checked',"#imgedit-save-target-"+i).val()||"full"},scaleChanged:function(i,t,e){var a=$("#imgedit-scale-width-"+i),o=$("#imgedit-scale-height-"+i),s=$("#imgedit-scale-warn-"+i),n="",d="";!1!==this.validateNumeric(e)&&(t?(d=""!==a.val()?Math.round(a.val()/this.hold.xy_ratio):"",o.val(d)):(n=""!==o.val()?Math.round(o.val()*this.hold.xy_ratio):"",a.val(n)),d&&d>this.hold.oh||n&&n>this.hold.ow?s.css("visibility","visible"):s.css("visibility","hidden"))},getSelRatio:function(i){var t=this.hold.w,e=this.hold.h,a=this.intval($("#imgedit-crop-width-"+i).val()),o=this.intval($("#imgedit-crop-height-"+i).val());return a&&o?a+":"+o:t&&e?t+":"+e:"1:1"},filterHistory:function(i,t){var e=$("#imgedit-history-"+i).val(),a,o,s,n,d=[];if(""!==e){if(e=JSON.parse(e),(a=this.intval($("#imgedit-undone-"+i).val()))>0)for(;a>0;)e.pop(),a--;if(t){if(!e.length)return this.hold.w=this.hold.ow,this.hold.h=this.hold.oh,"";s=e[e.length-1],s=s.c||s.r||s.f||!1,s&&(this.hold.w=s.fw,this.hold.h=s.fh)}for(o in e)n=e[o],n.hasOwnProperty("c")?d[o]={c:{x:n.c.x,y:n.c.y,w:n.c.w,h:n.c.h}}:n.hasOwnProperty("r")?d[o]={r:n.r.r}:n.hasOwnProperty("f")&&(d[o]={f:n.f.f});return JSON.stringify(d)}return""},refreshEditor:function(t,e,a){var o=this,s,n;o.toggleEditor(t,1),s={action:"imgedit-preview",_ajax_nonce:e,postid:t,history:o.filterHistory(t,1),rand:o.intval(1e6*Math.random())},n=$('<img id="image-preview-'+t+'" alt="" />').on("load",{history:s.history},function(e){var o,s,d=$("#imgedit-crop-"+t),r=i,l;""!==e.data.history&&(l=JSON.parse(e.data.history),l[l.length-1].hasOwnProperty("c")&&(r.setDisabled($("#image-undo-"+t),!0),$("#image-undo-"+t).focus())),d.empty().append(n),o=Math.max(r.hold.w,r.hold.h),s=Math.max($(n).width(),$(n).height()),r.hold.sizer=o>s?s/o:1,r.initCrop(t,n,d),r.setCropSelection(t,0),void 0!==a&&null!==a&&a(),$("#imgedit-history-"+t).val()&&"0"===$("#imgedit-undone-"+t).val()?$("input.imgedit-submit-btn","#imgedit-panel-"+t).removeAttr("disabled"):$("input.imgedit-submit-btn","#imgedit-panel-"+t).prop("disabled",!0),r.toggleEditor(t,0)}).on("error",function(){$("#imgedit-crop-"+t).empty().append('<div class="error"><p>'+imageEditL10n.error+"</p></div>"),o.toggleEditor(t,0)}).attr("src",ajaxurl+"?"+$.param(s))},action:function(i,t,e){var a=this,o,s,n,d,r;if(a.notsaved(i))return!1;if(o={action:"image-editor",_ajax_nonce:t,postid:i},"scale"===e){if(s=$("#imgedit-scale-width-"+i),n=$("#imgedit-scale-height-"+i),d=a.intval(s.val()),r=a.intval(n.val()),d<1)return s.focus(),!1;if(r<1)return n.focus(),!1;if(d===a.hold.ow||r===a.hold.oh)return!1;o.do="scale",o.fwidth=d,o.fheight=r}else{if("restore"!==e)return!1;o.do="restore"}a.toggleEditor(i,1),$.post(ajaxurl,o,function(t){$("#image-editor-"+i).empty().append(t),a.toggleEditor(i,0),a._view&&a._view.refresh()})},save:function(t,e){var a,o=this.getTarget(t),s=this.filterHistory(t,0),n=this;if(""===s)return!1;this.toggleEditor(t,1),a={action:"image-editor",_ajax_nonce:e,postid:t,history:s,target:o,context:$("#image-edit-context").length?$("#image-edit-context").val():null,do:"save"},$.post(ajaxurl,a,function(e){var a=JSON.parse(e);if(a.error)return $("#imgedit-response-"+t).html('<div class="error"><p>'+a.error+"</p></div>"),void i.close(t);a.fw&&a.fh&&$("#media-dims-"+t).html(a.fw+" &times; "+a.fh),a.thumbnail&&$(".thumbnail","#thumbnail-head-"+t).attr("src",""+a.thumbnail),a.msg&&$("#imgedit-response-"+t).html('<div class="updated"><p>'+a.msg+"</p></div>"),n._view?n._view.save():i.close(t)})},open:function(t,e,a){this._view=a;var o,s,n=$("#image-editor-"+t),d=$("#media-head-"+t),r=$("#imgedit-open-btn-"+t),l=r.siblings(".spinner");if(!r.hasClass("button-activated"))return l.addClass("is-active"),s={action:"image-editor",_ajax_nonce:e,postid:t,do:"open"},o=$.ajax({url:ajaxurl,type:"post",data:s,beforeSend:function(){r.addClass("button-activated")}}).done(function(e){n.html(e),d.fadeOut("fast",function(){n.fadeIn("fast"),r.removeClass("button-activated"),l.removeClass("is-active")}),i.init(t)})},imgLoaded:function(i){var t=$("#image-preview-"+i),e=$("#imgedit-crop-"+i);void 0===this.hold.sizer&&this.init(i),this.initCrop(i,t,e),this.setCropSelection(i,0),this.toggleEditor(i,0),$(".imgedit-wrap .imgedit-help-toggle").eq(0).focus()},initCrop:function(t,e,a){var o=this,s=$("#imgedit-sel-width-"+t),n=$("#imgedit-sel-height-"+t),d;o.iasapi=$(e).imgAreaSelect({parent:a,instance:!0,handles:!0,keys:!0,minWidth:3,minHeight:3,onInit:function(i){d=$(i),d.next().css("position","absolute").nextAll(".imgareaselect-outer").css("position","absolute"),a.children().on("mousedown, touchstart",function(i){var e=!1,a,s;i.shiftKey&&(a=o.iasapi.getSelection(),s=o.getSelRatio(t),e=a&&a.width&&a.height?a.width+":"+a.height:s),o.iasapi.setOptions({aspectRatio:e})})},onSelectStart:function(){i.setDisabled($("#imgedit-crop-sel-"+t),1)},onSelectEnd:function(e,a){i.setCropSelection(t,a)},onSelectChange:function(t,e){var a=i.hold.sizer;s.val(i.round(e.width/a)),n.val(i.round(e.height/a))}})},setCropSelection:function(i,t){var e;if(!(t=t||0)||t.width<3&&t.height<3)return this.setDisabled($(".imgedit-crop","#imgedit-panel-"+i),0),this.setDisabled($("#imgedit-crop-sel-"+i),0),$("#imgedit-sel-width-"+i).val(""),$("#imgedit-sel-height-"+i).val(""),$("#imgedit-selection-"+i).val(""),!1;e={x:t.x1,y:t.y1,w:t.width,h:t.height},this.setDisabled($(".imgedit-crop","#imgedit-panel-"+i),1),$("#imgedit-selection-"+i).val(JSON.stringify(e))},close:function(i,t){if((t=t||!1)&&this.notsaved(i))return!1;this.iasapi={},this.hold={},this._view?this._view.back():$("#image-editor-"+i).fadeOut("fast",function(){$("#media-head-"+i).fadeIn("fast",function(){$("#imgedit-open-btn-"+i).focus()}),$(this).empty()})},notsaved:function(i){var t=$("#imgedit-history-"+i).val(),e=""!==t?JSON.parse(t):[];return this.intval($("#imgedit-undone-"+i).val())<e.length&&!confirm($("#imgedit-leaving-"+i).html())},addStep:function(i,t,e){for(var a=this,o=$("#imgedit-history-"+t),s=""!==o.val()?JSON.parse(o.val()):[],n=$("#imgedit-undone-"+t),d=a.intval(n.val());d>0;)s.pop(),d--;n.val(0),s.push(i),o.val(JSON.stringify(s)),a.refreshEditor(t,e,function(){a.setDisabled($("#image-undo-"+t),!0),a.setDisabled($("#image-redo-"+t),!1)})},rotate:function(i,t,e,a){if($(a).hasClass("disabled"))return!1;this.addStep({r:{r:i,fw:this.hold.h,fh:this.hold.w}},t,e)},flip:function(i,t,e,a){if($(a).hasClass("disabled"))return!1;this.addStep({f:{f:i,fw:this.hold.w,fh:this.hold.h}},t,e)},crop:function(i,t,e){var a=$("#imgedit-selection-"+i).val(),o=this.intval($("#imgedit-sel-width-"+i).val()),s=this.intval($("#imgedit-sel-height-"+i).val());if($(e).hasClass("disabled")||""===a)return!1;a=JSON.parse(a),a.w>0&&a.h>0&&o>0&&s>0&&(a.fw=o,a.fh=s,this.addStep({c:a},i,t))},undo:function(i,t){var e=this,a=$("#image-undo-"+i),o=$("#imgedit-undone-"+i),s=e.intval(o.val())+1;a.hasClass("disabled")||(o.val(s),e.refreshEditor(i,t,function(){var t=$("#imgedit-history-"+i),o=""!==t.val()?JSON.parse(t.val()):[];e.setDisabled($("#image-redo-"+i),!0),e.setDisabled(a,s<o.length),o.length===s&&$("#image-redo-"+i).focus()}))},redo:function(i,t){var e=this,a=$("#image-redo-"+i),o=$("#imgedit-undone-"+i),s=e.intval(o.val())-1;a.hasClass("disabled")||(o.val(s),e.refreshEditor(i,t,function(){e.setDisabled($("#image-undo-"+i),!0),e.setDisabled(a,s>0),0===s&&$("#image-undo-"+i).focus()}))},setNumSelection:function(i,t){var e,a=$("#imgedit-sel-width-"+i),o=$("#imgedit-sel-height-"+i),s=this.intval(a.val()),n=this.intval(o.val()),d=$("#image-preview-"+i),r=d.height(),l=d.width(),h=this.hold.sizer,g,c,v,u,p=this.iasapi;if(!1!==this.validateNumeric(t))return s<1?(a.val(""),!1):n<1?(o.val(""),!1):void(s&&n&&(e=p.getSelection())&&(v=e.x1+Math.round(s*h),u=e.y1+Math.round(n*h),g=e.x1,c=e.y1,v>l&&(g=0,v=l,a.val(Math.round(v/h))),u>r&&(c=0,u=r,o.val(Math.round(u/h))),p.setSelection(g,c,v,u),p.update(),this.setCropSelection(i,p.getSelection())))},round:function(i){var t;return i=Math.round(i),this.hold.sizer>.6?i:(t=i.toString().slice(-1),"1"===t?i-1:"9"===t?i+1:i)},setRatioSelection:function(i,t,e){var a,o,s=this.intval($("#imgedit-crop-width-"+i).val()),n=this.intval($("#imgedit-crop-height-"+i).val()),d=$("#image-preview-"+i).height();!1!==this.validateNumeric(e)&&s&&n&&(this.iasapi.setOptions({aspectRatio:s+":"+n}),(a=this.iasapi.getSelection(!0))&&(o=Math.ceil(a.y1+(a.x2-a.x1)/(s/n)),o>d&&(o=d,t?$("#imgedit-crop-height-"+i).val(""):$("#imgedit-crop-width-"+i).val("")),this.iasapi.setSelection(a.x1,a.y1,a.x2,o),this.iasapi.update()))},validateNumeric:function(i){if(!this.intval($(i).val()))return $(i).val(""),!1}}}(jQuery);
//# sourceMappingURL=./image-edit-min.js.map