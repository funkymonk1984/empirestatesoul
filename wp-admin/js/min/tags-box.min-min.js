var tagBox,array_unique_noempty;!function(t){array_unique_noempty=function(i){var a=[];return t.each(i,function(i,e){e=t.trim(e),e&&-1===t.inArray(e,a)&&a.push(e)}),a},tagBox={clean:function(t){var i=window.tagsBoxL10n.tagDelimiter;return","!==i&&(t=t.replace(new RegExp(i,"g"),",")),t=t.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,""),","!==i&&(t=t.replace(/,/g,i)),t},parseTags:function(i){var a=i.id,e=a.split("-check-num-")[1],n=t(i).closest(".tagsdiv"),s=n.find(".the-tags"),c=window.tagsBoxL10n.tagDelimiter,u=s.val().split(c),o=[];return delete u[e],t.each(u,function(i,a){a=t.trim(a),a&&o.push(a)}),s.val(this.clean(o.join(c))),this.quickClicks(n),!1},quickClicks:function(i){var a,e,n=t(".the-tags",i),s=t(".tagchecklist",i),c=t(i).attr("id");n.length&&(e=n.prop("disabled"),a=n.val().split(window.tagsBoxL10n.tagDelimiter),s.empty(),t.each(a,function(i,a){var n,u;a=t.trim(a),a&&(n=t("<span />").text(a),e||(u=t('<a id="'+c+"-check-num-"+i+'" class="ntdelbutton" tabindex="0">X</a>'),u.on("click keypress",function(i){("click"===i.type||13===i.keyCode)&&(13===i.keyCode&&t(this).closest(".tagsdiv").find("input.newtag").focus(),tagBox.parseTags(this))}),n.prepend("&nbsp;").prepend(u)),s.append(n))}))},flushTags:function(i,a,e){var n,s,c,u=t(".the-tags",i),o=t("input.newtag",i),l=window.tagsBoxL10n.tagDelimiter;return a=a||!1,c=a?t(a).text():o.val(),"undefined"==typeof c?!1:(n=u.val(),s=n?n+l+c:c,s=this.clean(s),s=array_unique_noempty(s.split(l)).join(l),u.val(s),this.quickClicks(i),a||o.val(""),"undefined"==typeof e&&o.focus(),!1)},get:function(i){var a=i.substr(i.indexOf("-")+1);t.post(ajaxurl,{action:"get-tagcloud",tax:a},function(e,n){0!==e&&"success"==n&&(e=t('<p id="tagcloud-'+a+'" class="the-tagcloud">'+e+"</p>"),t("a",e).click(function(){return tagBox.flushTags(t("#"+a),this),!1}),t("#"+i).after(e))})},init:function(){var i=this,a=t("div.ajaxtag");t(".tagsdiv").each(function(){tagBox.quickClicks(this)}),t(".tagadd",a).click(function(){i.flushTags(t(this).closest(".tagsdiv"))}),t("input.newtag",a).keyup(function(i){return 13==i.which?(tagBox.flushTags(t(this).closest(".tagsdiv")),!1):void 0}).keypress(function(t){return 13==t.which?(t.preventDefault(),!1):void 0}).each(function(){var i=t(this).closest("div.tagsdiv").attr("id");t(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+i,{delay:500,minchars:2,multiple:!0,multipleSep:window.tagsBoxL10n.tagDelimiter})}),t("#post").submit(function(){t("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})}),t(".tagcloud-link").click(function(){return tagBox.get(t(this).attr("id")),t(this).unbind().click(function(){return t(this).siblings(".the-tagcloud").toggle(),!1}),!1})}}}(jQuery);